# test_docker.yml
#
# Integration tests for Ansible's Docker modules.
#
- name: Start the registry
  hosts: docker 
  connection: local
  gather_facts: no
  roles:
    - role: ansible.local-registry
      registry_users:
        - username: testuser
          password: testpassword
        - username: chris+house_knecht
          password: password123
      registry_auth_path: /data/auth
      registry_cert_path: /data/certs
      registry_host_cert_path: "{{ docker_data_path }}/certs"
      registry_host_auth_path: "{{ docker_data_path }}/auth"

- name: Wait for registry 
  hosts: docker
  connection: local
  gather_facts: no
  tasks: 
    - command: ping -c 3 "{{ registry_common_name }}" 
    - wait_for: host="{{ registry_common_name }}" port="{{ registry_host_port }}"   
    
- name: Run docker module tests 
  hosts: docker 
  connection: local
  gather_facts: no
  roles:
    - role: test_docker_login
    - role: test_docker_image
    - role: test_docker_container
    - role: test_docker_service

