---
- hosts: localhost
  connection: local
  gather_facts: yes
  tags:
    - cloudstack
  pre_tasks:
    # TODO: change image src once moved to ansible
    - shell: docker rm -f cloudstack || true; docker run --name cloudstack -d -p 8888:8888 resmo/cloudstack-sim
      tags: always
  roles:
    - { role: cs_prepare,              tags: always }
    - { role: cs_user,                 tags: cs_user }
    - { role: cs_project,              tags: cs_project }
    - { role: cs_iso,                  tags: cs_iso }
    - { role: cs_domain,               tags: cs_domain }
    - { role: cs_vmsnapshot,           tags: cs_vmsnapshot }
    - { role: cs_sshkeypair,           tags: cs_sshkeypair }
    - { role: cs_affinitygroup,        tags: cs_affinitygroup }
    - { role: cs_securitygroup,        tags: cs_securitygroup }
    - { role: cs_securitygroup_rule,   tags: cs_securitygroup_rule }
    - { role: cs_instance,             tags: cs_instance }
    - { role: cs_instancegroup,        tags: cs_instancegroup }
    - { role: cs_portforward,          tags: cs_portforward }
    - { role: cs_account,              tags: cs_account }
    - { role: cs_firewall,             tags: cs_firewall }
    - { role: cs_loadbalancer_rule,    tags: cs_loadbalancer_rule }
    - { role: cs_volume,               tags: cs_volume }
    - { role: cs_instance_facts,       tags: cs_instance_facts }
    - { role: cs_configuration,        tags: cs_configuration }
    - { role: cs_pod,                  tags: cs_pod }
    - { role: cs_cluster,              tags: cs_cluster }
    - { role: cs_resourcelimit,        tags: cs_resourcelimit }
    - { role: cs_vpc,                  tags: cs_vpc }
  post_tasks:
    - shell: docker rm -f cloudstack
      tags: always
