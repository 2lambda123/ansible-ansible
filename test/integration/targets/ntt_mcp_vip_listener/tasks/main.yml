- hosts: 127.0.0.1
  gather_facts: no
  connection: local
  tasks:
  - name: Create an internal VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_1
      description: "My VIP Listener"
      ip_address: "10.0.0.10"
      protocol: "TCP"
      port: 443
      pool: myPool1
      connection_limit: 60000
      connection_rate_limit: 3000
      persistence_profile: "CCDEFAULT.SourceAddress"
      fallback_persistence_profile: "CCDEFAULT.DestinationAddress"
      optimization_profile: TCP
      irules:
        - name: CCDEFAULT.IpProtocolTimers
      ssl_offload_profile: my_ssl_profile_2
      state: present
    register: vip
    tags:
      - create_internal

  - debug:
      var: vip
    tags:
      - create_internal

  - name: Create a duplicate VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_1
      description: "My VIP Listener"
      ip_address: "10.0.0.10"
      protocol: TCP
      port: 443
      pool: myPool1
      connection_limit: 60000
      connection_rate_limit: 3000
      persistence_profile: "CCDEFAULT.SourceAddress"
      fallback_persistence_profile: "CCDEFAULT.DestinationAddress"
      optimization_profile: TCP
      irules:
        - name: CCDEFAULT.IpProtocolTimers
      ssl_offload_profile: my_ssl_profile_2
      state: present
    register: vip
    tags:
      - create_duplicate

  - debug:
      var: vip
    tags:
      - create_duplicate

  - name: Create a public VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_2
      description: "My VIP Listener"
      ip_address: "168.128.31.151"
      protocol: TCP
      port: 443
      pool: myPool2
      connection_limit: 60000
      connection_rate_limit: 3000
      persistence_profile: "CCDEFAULT.SourceAddress"
      fallback_persistence_profile: "CCDEFAULT.DestinationAddress"
      optimization_profile: TCP
      irules:
        - name: CCDEFAULT.IpProtocolTimers
        - name: CCDEFAULT.Ips
      ssl_offload_profile: my_ssl_profile_2
      state: present
    register: vip
    tags:
      - create_public

  - debug:
      var: vip
    tags:
      - create_public

  - name: Create an invalid VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_invalid_vip
      description: "My invalid VIP Listener"
      ip_address: "168.128.31.150"
      protocol: GRE
      port: xyz
      pool: myPool2
      connection_limit: 60000
      connection_rate_limit: 3000
      persistence_profile: "CCDEFAULT.SourceAddress"
      fallback_persistence_profile: "CCDEFAULT.DestinationAddress"
      optimization_profile: TCP
      irules:
        - name: CCDEFAULT.IpProtocolTimers
      ssl_offload_profile: my_ssl_profile_2
      state: present
    register: vip
    tags:
      - create_invalid

  - debug:
      var: vip
    tags:
      - create_invalid

  - name: Update a VIP Listener - Remove the fallback persistence profile, update limits and pool
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_1
      description: "My updated VIP Listener"
      ip_address: "10.0.0.11"
      protocol: TCP
      port: 443
      pool: myPool2
      connection_limit: 50000
      connection_rate_limit: 2000
      persistence_profile: "CCDEFAULT.SourceAddress"
      optimization_profile: TCP
      state: present
    register: vip
    tags:
      - update

  - debug:
      var: vip
    tags:
      - update

  - name: Delete a VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_1
      state: absent
    register: vip
    tags:
      - delete_1

  - debug:
      var: vip
    tags:
      - delete_1

  - name: Delete a VIP Listener 2
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: my_vip_listener_2
      state: absent
    register: vip
    tags:
      - delete_2

  - debug:
      var: vip
    tags:
      - delete_2

  - name: Delete a non-existent VIP Listener
    ntt_mcp_vip_listener:
      region: na
      datacenter: NA12
      network_domain: myCND
      name: xyz
      state: absent
    register: vip
    tags:
      - delete_noexist

  - debug:
      var: vip
    tags:
      - delete_noexist
