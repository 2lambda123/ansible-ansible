# Test code for the vmware_guest_move module
# Copyright: (c) 2018, Jose Angel Munoz <josea.munoz@gmail.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)


- name: Create a sub folder under VM folder on given datacenter
  vcenter_folder:
    validate_certs: false
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    datacenter: "{{ dc1 }}"
    folder_name: vm2
    folder_type: vm
    state: present
  register: bob
- debug: var=bob

- name: test
  uri:
    url: http://{{ vcenter_hostname }}:5000/govc_find?filter=F
  register: boby
- debug: var=boby

# Testcase 0001: Move vm and get changed status
- name: Move VM (Changed)
  vmware_guest_move:
    validate_certs: false
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    datacenter: "{{ dc1 }}"
    name: "{{ guest1 }}"
    dest_folder: /F0/DC0/vm/F0
  register: vm_facts_0001


# Testcase 0002: Move vm and get OK status (Already Moved)
- name: Move VM (OK)
  vmware_guest_move:
    validate_certs: false
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    datacenter: "{{ dc1 }}"
    name: "{{ guest1 }}"
    dest_folder: /F0/DC0/vm/vm2
  register: vm_facts_0002

- debug:
    msg: "{{ vm_facts_0001 }}"

- debug:
    msg: "{{ vm_facts_0002 }}"

- name: get all VMs
  uri:
    url: http://{{ vcenter_hostname }}:5000/govc_find?filter=VM
  register: vms_diff

- name: Difference
  debug:
    var: vms_diff.json | difference(vms.json)
