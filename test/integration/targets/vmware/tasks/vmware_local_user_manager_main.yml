# Test code for the vmware_local_user_manager module.
# Copyright: (c) 2017, Abhijeet Kasurde <akasurde@redhat.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

# Commenting local user testcases as older vcsim docker image
# does not support this.

# Local user manager works only with standalone ESXi server
# Testcase 0001: Add Local user in ESXi server
- name: add local user
  vmware_local_user_manager:
    hostname: "{{ vcsim }}"
    username: "{{ vcsim_instance.json.username }}"
    password: "{{ vcsim_instance.json.password }}"
    validate_certs: no
    local_user_name: testuser_0001
    local_user_password: "SamplePassword!"
    state: present
  register: user_add_0001

- name: ensure user is created
  assert:
    that:
        - user_add_0001.changed == true

# Testcase 0002: Delete Local user in ESXi server
- name: Delete local user
  vmware_local_user_manager:
    hostname: "{{ vcsim }}"
    username: "{{ vcsim_instance.json.username }}"
    password: "{{ vcsim_instance.json.password }}"
    validate_certs: no
    local_user_name: testuser_0001
    state: absent
  register: user_delete_0002

- name: ensure user is deleted
  assert:
    that:
        - user_delete_0002.changed == true
