---
- block:

    # ============================================================
    - name: set connection information for all tasks
      set_fact:
        aws_connection_info: &aws_connection_info
          aws_access_key: "{{ aws_access_key }}"
          aws_secret_key: "{{ aws_secret_key }}"
          security_token: "{{ security_token }}"
          region: "{{ aws_region }}"
      no_log: true

    - name: Create VPC for use in testing
      ec2_vpc_net:
        name: "{{ resource_prefix }}-vpc"
        cidr_block: 10.22.32.0/23
        tags:
          Name: Ansible ec2_instance Testing VPC
        tenancy: default
        <<: *aws_connection_info
      register: testing_vpc

    # ============================================================
    - name: Create a public zone
      route53_zone:
        zone: "{{ resource_prefix }}.public"
        comment: original comment
        state: present
        <<: *aws_connection_info
      register: output

    - assert:
        that:
          - output.changed
          - output.comment == 'original comment'
          - output.name == '{{ resource_prefix }}.public.'
          - not output.private_zone

    # ============================================================
    - name: Create a public zone (CHECK MODE)
      route53_zone:
        zone: "{{ resource_prefix }}.check.public"
        comment: original comment
        state: present
        <<: *aws_connection_info
      register: output
      check_mode: yes

    - assert:
        that:
          - output.changed
          - output.comment == 'original comment'
          - output.name == '{{ resource_prefix }}.check.public.'
          - not output.private_zone
