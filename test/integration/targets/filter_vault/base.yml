- hosts: localhost
  gather_facts: false
  vars:
    dvault: '{{ "secret"|vault("test")}}'
    vaultedstring: "$ANSIBLE_VAULT;1.1;AES256\n33323332333033383335333533383338333333303339333733323339333833303334333133313339\n33373339333133323331333833373335333933323338333633343338333133343334333733383334\n33333335333433383337333133303339333433353332333333363339333733363335333233303330\n3337333733353331333633313335333733373334333733320a373938666533366165653830313163\n62386564343438653437333564383664646538653364343138303831613039313232636437336530\n3438376662373764650a633366646563386335623161646262366137393635633464333265613938\n6661\n"
    password: test
    data: secret
    vault: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        33323332333033383335333533383338333333303339333733323339333833303334333133313339
        33373339333133323331333833373335333933323338333633343338333133343334333733383334
        33333335333433383337333133303339333433353332333333363339333733363335333233303330
        3337333733353331333633313335333733373334333733320a373938666533366165653830313163
        62386564343438653437333564383664646538653364343138303831613039313232636437336530
        3438376662373764650a633366646563386335623161646262366137393635633464333265613938
        6661

    salt: '{{2**256|random(seed=inventory_hostname)}}'

  tasks:
    - name: check vaulting
      assert:
        that:
          - data|vault(password, salt=salt) == vaultedstring
          - "data|vault(password, salt=salt)|type_debug != 'AnsibleVaultEncryptedUnicode'"
          - "data|vault(password, salt=salt, wrap_object=True)|type_debug == 'AnsibleVaultEncryptedUnicode'"

    - name: check unvaulting
      assert:
        that:
          - vaultedstring|unvault(password) == data
          - vault|unvault(password) == data

