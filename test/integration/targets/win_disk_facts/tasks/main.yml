# NOTE: The win_disk_facts module only works on Win2012R2+

- name: Test Windows capabilities
  raw: Get-Command Get-Disk -ErrorAction SilentlyContinue; return $?
  register: new_diskfacts

- name: Fail if Windows is not capable
  fail: msg="Cmdlet Get-Disk is not available in your Windows version"
  when: new_diskfacts.rc == 1

- name: Only run tests when Windows is capable
  when: new_diskfacts.rc == 0
  block:

  - name: Test in normal mode
    include: tests.yml
