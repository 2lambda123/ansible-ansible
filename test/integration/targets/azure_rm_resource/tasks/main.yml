- name: Prepare random number
  set_fact:
    namespacename: "{{ resource_group | hash('md5') | truncate(7, True, '') }}{{ 1000 | random }}"
  run_once: yes

- name: Call REST API - Namespaces_CreateOrUpdate
  azure_rm_resource:
    api_version: '2017-04-01'
    resource_group: "{{ resource_group }}"
    provider: eventhub
    resource_type: namespaces
    resource_name: "{{ namespacename }}"
    body:
      location: eastus
      sku:
        name: Basic
        tier: Basic
        capacity: 10
      properties:
        isAutoInflateEnabled: False
    idempotency: yes
  register: output

- name: Assert that something has changed
  assert:
    that: output.changed

- name: Call REST API - Namespaces_CreateOrUpdate
  azure_rm_resource:
    api_version: '2017-04-01'
    resource_group: "{{ resource_group }}"
    provider: eventhub
    resource_type: namespaces
    resource_name: "{{ namespacename }}"
    body:
      location: eastus
      sku:
        name: Basic
        tier: Basic
        capacity: 10
      properties:
        isAutoInflateEnabled: False
    idempotency: yes
  register: output

- name: Assert that nothing has changed
  assert:
    that: not output.changed

- name: Call REST API - Namespaces_CreateOrUpdate
  azure_rm_resource:
    api_version: '2017-04-01'
    resource_group: "{{ resource_group }}"
    provider: eventhub
    resource_type: namespaces
    resource_name: "{{ namespacename }}"
    body:
      location: eastus
      sku:
        name: Basic
        tier: Basic
        capacity: 15
      properties:
        isAutoInflateEnabled: False
    idempotency: yes
  register: output

- name: Assert that something has changed
  assert:
    that: output.changed


- name: Try to get information about account
  azure_rm_resource_facts:
    api_version: '2017-04-01'
    resource_group: "{{ resource_group }}"
    provider: eventhub
    resource_type: namespaces
    resource_name: "{{ namespacename }}"
  register: output
