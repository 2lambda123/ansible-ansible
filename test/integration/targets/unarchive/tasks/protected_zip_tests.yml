- name: create file
  file: path={{output_dir}}/somefile state=touch

- name: create zip with password
  shell:  zip --password 1234 test-password.zip somefile chdir={{output_dir}}

- name: unarchive file with password
  unarchive: src={{output_dir}}/test-password.zip dest=/tmp/ password=1234

- name: verify that the file was unarchived
  file: path=/tmp/somefile state=file

- name: clean up test artifacts
  file: path={{output_dir}}/test-password.zip state=absent

- name: clean up test artifacts
  file: path={{output_dir}}/somefile state=absent

# negative case unzip with wrong password
- name: create file
  file: path={{output_dir}}/somefile state=touch

- name: create zip with password
  shell:  zip --password 1234 test-password.zip somefile chdir={{output_dir}}

- name: unarchive file with password
  unarchive: src={{output_dir}}/test-password.zip dest=/tmp/ password=wrongpass
  register: unarchive
  ignore_errors: yes

- name: check that we got error incorrect password
  assert:
    that:
      - '"failed to unpack" in unarchive.msg'

- name: clean up test artifacts
  file: path={{output_dir}}/test-password.zip state=absent
