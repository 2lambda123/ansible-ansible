- name: TEARDOWN | Destroy NIC
  azure_rm_networkinterface:
    resource_group: "{{ resource_group }}"
    name: "{{ vm_name }}"
    state: absent

- name: TEARDOWN | Destroy security groups
  azure_rm_securitygroup:
    resource_group: "{{ resource_group }}"
    name: "{{ item }}"
    state: absent
  loop:
    - "{{ hostvars['azure_testhost_2']['vm_name'] }}"
    - "{{ vm_name }}"

- name: TEARDOWN | Destroy subnet
  azure_rm_subnet:
      resource_group: "{{ resource_group }}"
      virtual_network: "{{ vm_name }}"
      name: "{{ vm_name }}"
      state: absent

- name: TEARDOWN | Destroy virtual network
  azure_rm_virtualnetwork:
    resource_group: "{{ resource_group }}"
    name: "{{ vm_name }}"
    state: absent

- name: TEARDOWN | Destroy public ip
  azure_rm_publicipaddress:
    resource_group: "{{ resource_group }}"
    name: "{{ vm_name }}"
    state: absent

- name: TEARDOWN | Destroy availability sets
  azure_rm_availabilityset:
    resource_group: "{{ resource_group }}"
    name: "{{ item }}"
    state: absent
  loop: "{{ availability_set_names | reverse | list }}"

- name: TEARDOWN | Destroy storage accounts
  azure_rm_storageaccount:
    resource_group: "{{ resource_group }}"
    name: "{{ item }}"
    force_delete_nonempty: true
    state: absent
  loop: "{{ storage_accounts | reverse | list }}"
