---


- set_fact: 
    latin1_file1="{{tmp_dir}}/{{file}}"

- name: create Latin1 encoded database
  mysql_db:
    name: '{{ db_latin1_name }}'
    state: present
    encoding: latin1
    login_unix_socket: '{{ mysql_socket }}'

- name: create a table in Latin1 database
  command: mysql {{ db_latin1_name }} '-e create table testlatin1(id int, name varchar(100));'

- name: inserting data into Latin1 database
  command: mysql {{ db_latin1_name }} "-e insert into testlatin1 value(47,'Amédée Bôlüt');"

- name: selecting table
  command: mysql {{ db_latin1_name }} "-e select * from testlatin1;"
  register: output


- name: Dumping a table in Latin1 database
  mysql_db:
    name: "{{ db_latin1_name }}"
    encoding: latin1
    target: "{{ latin1_file1 }}"
    state: dump
    login_unix_socket: '{{ mysql_socket }}'
  register: dump_result

- debug: 
    var: dump_result  

- name: check /tmp
  stat: 
    path: "/tmp/{{ latin1_file1 }}" 
  register: stat_result

- name: state dump - file name should exist
  file: name={{ latin1_file1 }} state=file

- name:  od the file and check of latin1 encoded string is present
  shell: grep -a 47 {{ latin1_file1 }} | od -c |grep "(   4   7   ,   '   A   m 351   d 351   e       B 364   l 374"


- name: remove database name
  mysql_db:
    name: '{{ db_latin1_name }}'
    state: absent
    login_unix_socket: '{{ mysql_socket }}'

