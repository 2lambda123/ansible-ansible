# state=present

- name: Test addition
  flatpak:
    name: org.gnome.Calculator
    remote: flathub
    state: present
  register: addition_result

- name: Verify addition test result
  assert:
    that:
      - "addition_result.changed == true"
    msg: "state=preset shall add flatpak when absent"

- name: Test idempotency of installation
  flatpak:
    name: org.gnome.Calculator
    remote: flathub
    state: present
  register: double_addition_result

- name: Verify idempotency of installation test result
  assert:
    that:
      - "double_addition_result.changed == false"
    msg: "state=present shall not do anything when flatpak is already present"

# state=absent

- name: Test removal
  flatpak:
    name: org.gnome.Calculator
    state: absent
  register: removal_result

- name: Verify removal test result
  assert:
    that:
      - "removal_result.changed == true"
    msg: "state=absent shall remove flatpak when present"

- name: Test idempotency of removal
  flatpak:
    name: org.gnome.Calculator
    state: absent
  register: double_removal_result

- name: Verify idempotency of removal test result
  assert:
    that:
      - "double_removal_result.changed == false"
    msg: "state=absent shall not do anything when flatpak is not present"

# state=present with url as name

- name: Test addition with url
  flatpak:
    name: https://flathub.org/repo/appstream/org.gnome.Calculator.flatpakref
    remote: flathub
    state: present
  register: url_addition_result

- name: Verify addition test result
  assert:
    that:
      - "url_addition_result.changed == true"
    msg: "state=preset with url as name shall add flatpak when absent"

- name: Test idempotency of installation with url
  flatpak:
    name: https://flathub.org/repo/appstream/org.gnome.Calculator.flatpakref
    remote: flathub
    state: present
  register: double_url_addition_result

- name: Verify idempotency of installation with url test result
  assert:
    that:
      - "double_url_addition_result.changed == false"
    msg: "state=present with url as name shall not do anything when flatpak is already present"

# state=absent with url as name

- name: Test removal with url
  flatpak:
    name: https://flathub.org/repo/appstream/org.gnome.Calculator.flatpakref
    state: absent
  register: url_removal_result

- name: Verify removal test result
  assert:
    that:
      - "url_removal_result.changed == true"
    msg: "state=absent with url as name shall remove flatpak when present"

- name: Test idempotency of removal with url
  flatpak:
    name: https://flathub.org/repo/appstream/org.gnome.Calculator.flatpakref
    state: absent
  register: double_url_removal_result

- name: Verify idempotency of removal with url test result
  assert:
    that:
      - "double_url_removal_result.changed == false"
    msg: "state=absent with url as name shall not do anything when flatpak is not present"
