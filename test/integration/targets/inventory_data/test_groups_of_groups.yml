---
- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
  - debug: var=groups

  - name: assert that group and hosts from the partially failed source are not in inventory
    assert:
      that:
        - "groups.testgroupinbadsource is undefined"
        - "hostvars.testhostinbadsource is undefined"
        - "groups.all.testhostinbadsource is undefined"

  - name: assert the groups and hosts from the viable source exist
    assert:
      that:
        - "groups.all == groups.all_east"
        - "groups.all == ['node01', 'node02', 'node03', 'node04', 'node05']"
        - "groups.east1 == ['node01', 'node02']"
        - "groups.east2 == ['node03', 'node04', 'node05']"
        - "groups.ungrouped == []"

  - assert:
      that:
        - "hostvars.{{ item }} is defined"
    loop: "{{ groups.all }}"
