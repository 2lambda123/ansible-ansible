---

- name: Modify a permission.
  block:
    - ipa_permission:
        cn: "{{ ipa_permission_cn }}"
        ipapermbindruletype: anonymous
        ipapermright:
          - read
          - write
        type: user
        attrs:
          - cn
          - ou
        state: present
        ipa_host: "{{ freeipa_server_domain }}"
        ipa_user: "{{ freeipa_admin }}"
        ipa_pass: "{{ freeipa_admin_password }}"
        validate_certs: "{{ freeipa_validate_certs }}"
      register: ipa_permission_output

    - assert:
        that:
          - '"read" in ipa_permission_output.permission.ipapermright'
          - '"write" in ipa_permission_output.permission.ipapermright'
          - '"cn" in ipa_permission_output.permission.ipapermincludedattr'
          - '"ou" in ipa_permission_output.permission.ipapermincludedattr'
          - '"anonymous" in ipa_permission_output.permission.ipapermbindruletype'
          - ipa_permission_output.permission.ipapermbindruletype | length == 1
