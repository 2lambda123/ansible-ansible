#turn off so then we can test changes occur on enable. Turning off for object access also
#covers our subcategory test for file system
- name: turn off auditing for category
  win_audit_policy_system:
    category: "{{ category }}"
    audit_type: none

- name: turn off auditing for subcategory
  win_audit_policy_system:
    subcategory: "{{ subcategory }}"
    audit_type: none

- block:
    - include_tasks: backup_restore.yml
    - include_tasks: add.yml
    - include_tasks: remove.yml
  always:
  - name: CLEANUP turn "{{ category }}" back to no auditing
    win_audit_policy_system:
      category: "{{ category }}"
      audit_type: none
  - name: CLEANUP turn "{{ subcategory }}" back to no auditing
    win_audit_policy_system:
      subcategory: "{{ subcategory }}"
      audit_type: none
  - name: CLEANUP delete backup file
    win_file:
      path: "{{ backup_path }}"
      state: absent
