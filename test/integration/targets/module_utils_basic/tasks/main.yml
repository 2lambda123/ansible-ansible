- name: Copy task with no mode
  copy:
    src: source.txt
    dest: "{{ output_dir }}/endangerdisown"
  register: copy_no_mode_results

- name: Copy task with no mode
  copy:
    src: source.txt
    dest: "{{ output_dir }}/groveestablish"
    mode: '0644'
  register: copy_with_mode_results

- name: Ensure we get a warning when appropriate
  assert:
    that:
      - copy_no_mode_results.warnings | length == 1
      - "'created with default permissions' in copy_no_mode_results.warnings[0]"
      - copy_with_mode_results.warnings | default([], True) | length == 0
