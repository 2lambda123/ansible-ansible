- hosts: localhost
  connection: local
  gather_facts: no
  vars:
    ansible_python_interpreter: "{{ ansible_playbook_python }}"
    recreate_crd_default_merge_expectation: recreate_crd is failed

  tasks:
    - python_requirements_facts:
        dependencies:
          - openshift==0.6.0
          - kubernetes==6.0.0

    - name: use append_hash with ConfigMap
      k8s:
        definition:
          metadata:
            name: config-map-test
            namespace: testing5
          apiVersion: v1
          kind: ConfigMap
          data:
            hello: world
        append_hash: yes
      register: k8s_configmap

    - name: assert that append_hash fails gracefully
      assert:
        that:
          - k8s_configmap is failed
          - k8s_configmap.msg

