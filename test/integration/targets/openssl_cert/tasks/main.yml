- name: Generate privatekey
  openssl_privatekey:
    path: '{{ output_dir }}/privatekey.pem'

- name: Generate CSR
  openssl_csr:
    path: '{{ output_dir }}/csr.csr'
    privatekey_path: '{{ output_dir }}/privatekey.pem'
    commonName: 'www.ansible.com'

- name: Generate certificate
  openssl_cert:
    path: '{{ output_dir }}/cert.selfsign.crt'
    privatekey_path: '{{ output_dir }}/privatekey.pem'
    csr_path: '{{ output_dir }}/csr.csr'
    provider: selfsigned

- name: Check some properties of the generated certificate
  openssl_cert:
    path: '{{ output_dir }}/cert.selfsign.crt'
    privatekey_path: '{{ output_dir }}/privatekey.pem'
    csr_path: '{{ output_dir }}/csr.csr'
    provider: assertonly
    version: 3
    subject:
      CN: www.ansible.com
    signature_algorithms:
      - sha256WithRSAEncryption

- import_tasks: ../tests/validate.yml
