- name: cleanup dns view instance
  nios_dns_view:
    name: ansible-dns
    state: absent
    provider: "{{ nios_provider }}"

- name: cleanup test zone
  nios_zone:
    name: ansible-dns
    state: absent
    provider: "{{ nios_provider }}"

- name: configure a zone on the system
  nios_zone:
    name: ansible-dns
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create1

- name: configure a zone on the system
  nios_zone:
    name: ansible-dns
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create2

- name: configure a zone on the system using grid primary and secondaries
  nios_zone:
    name: ansible.com
    grid_primary:
      - name: gridprimary.grid.com
    grid_secondaries:
      - name: gridsecondary1.grid.com
      - name: gridsecondary2.grid.com
    restart_if_needed: true
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create3

- name: re-configure a zone on the system using grid primary and secondaries
  nios_zone:
    name: ansible.com
    grid_primary:
      - name: gridprimary.grid.com
    grid_secondaries:
      - name: gridsecondary1.grid.com
      - name: gridsecondary2.grid.com
    restart_if_needed: true
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create4

- name: configure a zone on the system using a name server group
  nios_zone:
    name: ansible.com
    ns_group: examplensg
    restart_if_needed: true
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create5

- name: re-configure a zone on the system using a name server group
  nios_zone:
    name: ansible.com
    ns_group: examplensg
    restart_if_needed: true
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create6

- name: configure a reverse mapping zone on the system using IPV4
  nios_zone:
    name: 10.10.10.in-addr.arpa
    format: IPV4
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create7

- name: re-configure a reverse mapping zone on the system using IPV4
  nios_zone:
    name: 10.10.10.in-addr.arpa
    format: IPV4
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create8

- name: configure a reverse mapping zone on the system using IPV6
  nios_zone:
    name: 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1.0.ip6.arpa
    format: IPV6
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create9

- name: re-configure a reverse mapping zone on the system using IPV6
  nios_zone:
    name: 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.1.0.ip6.arpa
    format: IPV6
    state: present
    provider: "{{ nios_provider }}"
  register: zone_create10

- name: update the comment and ext attributes for an existing zone
  nios_zone:
    name: ansible-dns
    comment: this is an example comment
    extattrs:
      Site: west-dc
    state: present
    provider: "{{ nios_provider }}"
  register: zone_update1

- name: update the comment and ext attributes for an existing zone
  nios_zone:
    name: ansible-dns
    comment: this is an example comment
    extattrs:
      Site: west-dc
    state: present
    provider: "{{ nios_provider }}"
  register: zone_update2

- name: remove the dns zone
  nios_zone:
    name: ansible-dns
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete1

- name: remove the dns zone
  nios_zone:
    name: ansible-dns
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete2

- name: remove the zone on the system with grid primary and secondaries
  nios_zone:
    name: ansible.com
    grid_primary:
      - name: gridprimary.grid.com
    grid_secondaries:
      - name: gridsecondary1.grid.com
      - name: gridsecondary2.grid.com
    restart_if_needed: true
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete3

- name: remove the zone on the system with grid primary and secondaries
  nios_zone:
    name: ansible.com
    grid_primary:
      - name: gridprimary.grid.com
    grid_secondaries:
      - name: gridsecondary1.grid.com
      - name: gridsecondary2.grid.com
    restart_if_needed: true
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete4

- name: remove the zone on the system with a name server group
  nios_zone:
    name: ansible.com
    ns_group: examplensg
    restart_if_needed: true
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete5

- name: remove the zone on the system with a name server group
  nios_zone:
    name: ansible.com
    ns_group: examplensg
    restart_if_needed: true
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete6

- name: remove the reverse mapped dns zone
  nios_zone:
    name: 10.10.10.in-addr.arpa
    format: IPV4
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete7

- name: remove the reverse mapped dns zone
  nios_zone:
    name: 10.10.10.in-addr.arpa
    format: IPV4
    state: absent
    provider: "{{ nios_provider }}"
  register: zone_delete8

- assert:
    that:
      - "zone_create1.changed"
      - "not zone_create2.changed"
      - "zone_create3.changed"
      - "not zone_create4.changed"
      - "zone_create5.changed"
      - "not zone_create6.changed"
      - "zone_create7.changed"
      - "not zone_create8.changed"
      - "zone_create9.changed"
      - "not zone_create10.changed"
      - "zone_update1.changed"
      - "not zone_update2.changed"
      - "zone_delete1.changed"
      - "not zone_delete2.changed"
      - "zone_delete3.changed"
      - "not zone_delete4.changed"
      - "zone_delete5.changed"
      - "not zone_delete6.changed"
      - "zone_delete7.changed"
      - "not zone_delete8.changed"
