- name: ARCHIVE | Clear checkout_dir
  file:
    state: absent
    path: "{{ checkout_dir }}"

- name: ARCHIVE | Archive repo using various archival format
  git:
    repo: '{{ repo_format1 }}'
    dest: '{{ checkout_dir }}'
    archive: '{{ checkout_dir }}/test_role.{{ item }}'
  register: git_archive
  with_items:
    - tar.gz
    - tar
    - tgz
    - zip

- assert:
    that: git_archive.results | map(attribute='changed') | unique | list == [true]

- name: ARCHIVE | Check if archive file is created or not
  stat:
    path: '{{ checkout_dir }}/test_role.{{ item }}'
  register: archive_check
  with_items:
    - tar.gz
    - tar
    - tgz
    - zip

- assert:
    that: archive_check.results | map(attribute='stat.exists') | unique | list == [true]
