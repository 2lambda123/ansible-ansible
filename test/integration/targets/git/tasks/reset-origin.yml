---
- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
  - name: Clean up
    file:
      state: absent
      path: "{{ item }}"
    with_items:
      - "{{ source_dir }}"
      - "{{ destination_dir }}"

  - name: Create a directory
    file:
      name:  "{{ source_dir }}"
      state: directory

  - name: Initialise the repo with a file named origin
    shell: git init; echo "{{ msg }}" > origin; git add origin; git commit -m "{{ msg }}"
    args:
      chdir: "{{ source_dir }}"

  - name: Clone a git repo with file named origin
    git:
      repo: "{{ source_dir }}"
      dest: "{{ destination_dir }}"
      remote: origin
      update: no
    register: status
