# Test creating ssh key with passphrase and 500 rounds
- name: Remove ansibulluser
  user:
    name: ansibulluser
    state: absent

- name: Create user with ssh key and 500 rounds
  user:
    name: ansibulluser
    state: present
    generate_ssh_key: yes
    force: yes
    ssh_key_file: .ssh/test_id_rsa
    ssh_key_passphrase: secret_passphrase
    ssh_key_rounds: 500
  register: ansibulluser_create_with_ssh_key_rounds

- name: Unlock ssh key
  command: "ssh-keygen -y -f {{ ansibulluser_create_with_ssh_key_rounds.ssh_key_file|quote }} -P secret_passphrase"
  register: result

- name: Check that ssh key was unlocked successfully
  assert:
    that:
      - result.rc == 0

- name: Clean ssh key
  file:
    path: "{{ ansibulluser_create_with_ssh_key_rounds.ssh_key_file }}"
    state: absent
  when: ansible_os_family == 'FreeBSD'
