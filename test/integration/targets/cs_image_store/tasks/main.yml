---
- name: setup image store is absent
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    state: absent
  register: sp
- name: verify setup image store is absent
  assert:
    that:
      - sp is successful

- name: test fail if missing params
  cs_image_store:
  register: ss
  ignore_errors: true
- name: verify test fail if missing params
  assert:
    that:
      - ss is failed
      - "ss.msg == 'missing required arguments: zone, name'"

- name: setup image store with wrong parameters
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    state: present
  ignore_errors: true
  register: ss
- name: verify setup image store with wrong parameters
  assert:
    that:
      - ss is failed
      - "ss.msg == 'state is present but all of the following are missing: url, provider'"


- name: setup image store
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    url: "nfs://nfs-mount.domain/share/images/"
    provider: "NFS"
    state: present
  ignore_errors: true
  register: ss
- name: verify setup image store
  assert:
    that:
      - ss is successful

- name: setup image store idempotence
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    url: "nfs://nfs-mount.domain/share/images/"
    provider: "NFS"
    state: present
  ignore_errors: true
  register: ss
- name: verify setup image store idempotence
  assert:
    that:
      - ss is not changed

- name: delete the image store
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    state: absent
  ignore_errors: true
  register: ss
- name: verify results for delete the image store
  assert:
    that:
      - ss is successful

- name: delete the image store idempotence
  cs_image_store:
    name: "storage_pool_adv"
    zone: "{{ cs_common_zone_adv }}"
    state: absent
  ignore_errors: true
  register: ss
- name: verify delete the image store idempotence
  assert:
    that:
      - ss is successful
      - ss is not changed