# NOTE: The win_disk_management module only works on Win2012R2+

- name: Test Windows capabilities
  raw: Get-Command Get-Disk -ErrorAction SilentlyContinue; return $?
  failed_when: no
  register: new_diskmanagement

- name: Only run tests when Windows is capable
  when: new_diskmanagement.rc == 0
  block:

  - name: Test in normal mode
    include: tests.yml
    vars:
      in_check_mode: no

  - name: Test in check-mode
    include: tests.yml
    vars:
      in_check_mode: yes
    check_mode: yes
