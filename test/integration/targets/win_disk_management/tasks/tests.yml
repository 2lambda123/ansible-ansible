- name: fail select and manage a specified disk because specified disk is not attached
  win_disk_management:
    size: '{{test_win_disk_management_size}}'
    partition_style_select: raw
    operational_status: offline
    drive_letter: '{{test_win_disk_management_letter}}'
  register: fail_not_attached
  failed_when: fail_not_attached.msg != 'No disk could be found and selected with the specified parameter options'

- name: fail select and manage a specified disk because specified disk could not be found
  win_disk_management:
    size: 50
    partition_style_select: raw
    operational_status: offline
  register: fail_not_found
  failed_when: fail_not_found.search_log.disk.disks_found != '0'

# Use result of module (disk number)
- name: fail select and manage a specified disk because specified disk is not attached, check results
  win_disk_management:
    size: 100
    partition_style_select: raw
    operational_status: offline
    read_only: true
  register: setup_specified_disk
  failed_when: setup_specified_disk.msg != 'No disk could be found and selected with the specified parameter options'
  
- name: get result of disk setup
  win_command: powershell.exe (get-disk -number 0).Number
  register: get_disk_actual

- name: assert setup disk
  assert:
    that:
    - not setup_specified_disk|changed
  when: not in_check_mode
