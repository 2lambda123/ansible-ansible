- name: fail select and manage a specified disk with invalid letter
  win_disk_management:
    disk_size: 50
    partition_style_select: mbr
    operational_status: online
    read_only: false
    drive_letter: '{{test_win_disk_management_letter}}'
  register: fail_invalid_letter
  failed_when: fail_invalid_letter.msg != 'Option drive_letter with value c contains protected letters C or D'

- name: fail select and manage a specified disk with invalid disk size for NTFS
  win_disk_management:
    disk_size: '{{test_win_disk_management_size}}'
    partition_style_select: raw
    operational_status: offline
    read_only: true
    partition_style_set: gpt
    drive_letter: f
    file_system: ntfs
    label: application_disk
  register: fail_invalid_size
  failed_when: fail_invalid_size.msg != 'Option disk_size with value 257000 GB is not a valid size for NTFS, the disk can not be not formatted with this file system'

- name: Select a specified disk and manage it with the specified values for set options
  win_disk_management:
    disk_size: 50
    partition_style_select: mbr
    operational_status: online
    read_only: false
    partition_style_set: gpt
    drive_letter: f
    file_system: refs
    label: application_disk
    allocation_unit_size: 64
    integrity_streams: true

- name: Test manage_specified_disk
  assert:
    that:
    - manage_specified_disk.changed == true
    - manage_specified_disk.general_log.create_volume == 'successful'

- name: Test manage_specified_disk_again (normal mode)
  assert:
    that:
    - manage_specified_disk_again.changed == true
    - manage_specified_disk_again.general_log.create_volume == 'successful'
  when: not in_check_mode

- name: Test add_specified_disk_again (check-mode)
  assert:
    that:
    - manage_specified_disk_again.changed == false
    - manage_specified_disk_again.general_log.create_volume == 'check_mode'
  when: in_check_mode

#  Use result of module (disk number)
- name: Select a specified disk and set it up with default set option values
  win_disk_management:
    disk_size: 100
    partition_style_select: raw
    operational_status: offline
    read_only: true
  register: setup_specified_disk
  
- name: get result of disk setup
  win_command: powershell.exe (get-disk -number 1).Number
  register: get_disk_actual

- name: assert setup disk
  assert:
    that:
    - setup_specified_disk|changed
    - setup_specified_disk.disk.disk_number_chosen == get_disk_actual
    - get_disk_actual.rc == 0
