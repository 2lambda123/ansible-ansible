---

- name: Rename a non-existent privilege.
  block:
    - ipa_privilege:
        cn: "NON_EXISTENT_PRIVILEGE"
        rename: "{{ ipa_privilege_rename }}"
        state: present
        ipa_host: "{{ freeipa_server_domain }}"
        ipa_user: "{{ freeipa_admin }}"
        ipa_pass: "{{ freeipa_admin_password }}"
        validate_certs: "{{ freeipa_validate_certs }}"
      ignore_errors: true
      register: ipa_privilege_output

    - assert:
        that:
          - false == ipa_privilege_output.changed

- name: Rename a privilege without permission.
  block:
    - ipa_privilege:
        cn: "{{ ipa_privilege_cn }}"
        rename: "{{ ipa_privilege_rename }}"
        state: present
        ipa_host: "{{ freeipa_server_domain }}"
        ipa_user: "{{ freeipa_admin }}"
        ipa_pass: "{{ freeipa_admin_password }}"
        validate_certs: "{{ freeipa_validate_certs }}"
      register: ipa_privilege_output

    - assert:
        that:
          - ipa_privilege_output.changed

- name: Rename a privilege with permission.
  block:
    - ipa_privilege:
        cn: "{{ ipa_privilege_rename }}"
        permission:
          - "{{ ipa_permission_cn1 }}"
          - "{{ ipa_permission_cn2 }}"
        rename: "{{ ipa_privilege_cn }}"
        state: present
        ipa_host: "{{ freeipa_server_domain }}"
        ipa_user: "{{ freeipa_admin }}"
        ipa_pass: "{{ freeipa_admin_password }}"
        validate_certs: "{{ freeipa_validate_certs }}"
      register: ipa_privilege_output

    - assert:
        that:
          - '"{{ ipa_privilege_cn }}" in ipa_privilege_output.privilege.cn'
          - '"{{ ipa_permission_cn1 }}" in ipa_privilege_output.privilege.memberof_permission'
          - '"{{ ipa_permission_cn2 }}" in ipa_privilege_output.privilege.memberof_permission'
