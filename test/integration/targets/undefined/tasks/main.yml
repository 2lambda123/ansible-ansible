- when: lookup('pipe', ansible_playbook_python ~ ' -c "import jinja2; print(jinja2.__version__)"') is version('2.7', '>=')
  block:
    - set_fact:
        names: '{{ things|map(attribute="name") }}'
      vars:
        things:
          - name: one
          - name: two
          - notname: three
          - name: four
      ignore_errors: true
      register: undefined_set_fact

    - assert:
        that:
          - '("%r"|format(undef)).startswith("AnsibleUndefined")'
          - undefined_set_fact is failed
          - undefined_set_fact.msg is contains 'undefined variable'
