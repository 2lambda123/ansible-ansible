---
- name: disable disabled site
  apache2_conf:
    type: site
    name: site_example.conf
    state: absent
  register: disable_disabled

- name: ensure apache2_conf is idempotent
  assert:
    that:
      - 'not disable_disabled.changed'

- name: enable site
  apache2_conf:
    type: site
    name: site_example.conf
    state: present
  register: enable

- name: ensure changed on successful enable
  assert:
    that:
      - 'enable.changed'

- name: enable enabled site
  apache2_conf:
    type: site
    name: site_example.conf
    state: present
  register: enable_enabled

- name: ensure apache2_conf is idempotent
  assert:
    that:
      - 'not enable_enabled.changed'

- name: disable site
  apache2_conf:
    type: site
    name: site_example.conf
    state: absent
  register: disable

- name: ensure changed on successful disable
  assert:
    that:
      - 'disable.changed'

- name: enable nonexistent site
  apache2_conf:
    type: site
    name: site_nonexistent.conf
    state: present
  register: enable_nonexistent
  ignore_errors: True

- name: ensure failed on nonexistent site enable
  assert:
    that:
      - 'enable_nonexistent|failed'
      - 'not enable_nonexistent.changed'

- name: disable nonexistent site
  apache2_conf:
    type: site
    name: site_nonexistent.conf
    state: absent
  register: disable_nonexistent
  ignore_errors: True

- name: ensure failed on nonexistent site disable
  assert:
    that:
      - 'disable_nonexistent|failed'
      - 'not disable_nonexistent.changed'

- name: enable site by short name
  apache2_conf:
    type: site
    name: site_example
    state: present
  register: enable_short

- name: ensure changed on successful enable
  assert:
    that:
      - 'enable_short.changed'

- name: disable site by short name
  apache2_conf:
    type: site
    name: site_example
    state: absent
  register: disable_short

- name: ensure changed on successful disable
  assert:
    that:
      - 'disable_short.changed'

- name: enable wrong site
  apache2_conf:
    type: site
    name: /etc/resolv.conf
    state: present
  register: enable_wrong
  ignore_errors: True

- name: ensure failed on enable wrong conf
  assert:
    that:
      - 'enable_wrong|failed'
