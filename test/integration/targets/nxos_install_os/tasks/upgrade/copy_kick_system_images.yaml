---
- set_fact: ignore_errors_httpapi='no'
- set_fact: ignore_errors_httpapi='yes'
  when: ansible_connection == 'httpapi'

- include: targets/nxos_install_os/tasks/upgrade/enable_scp_server.yaml
  when: connection is not defined

- include: targets/nxos_install_os/tasks/upgrade/enable_scp_server_provider.yaml
  when: connection is defined

- name: "Copy {{ si }} to bootflash"
  expect:
    command: "scp {{image_dir}}{{ si }} {{ ansible_ssh_user }}@{{ ansible_ssh_host }}:"
    responses:
      (?i)password: "{{ ansible_ssh_pass }}"
    timeout: 1000
  register: result

- debug:
    msg: "{{ item.key }} {{ item.value }}"
  with_dict: "{{ result }}"

- name: "Copy {{ ki }} to bootflash"
  expect:
    command: "scp {{image_dir}}{{ ki }} {{ ansible_ssh_user }}@{{ ansible_ssh_host }}:"
    responses:
      (?i)password: "{{ ansible_ssh_pass }}"
    timeout: 1000
  when: ki is defined
  register: result

- debug:
    msg: "{{ item.key }} {{ item.value }}"
  with_dict: "{{ result }}"
  when: ki is defined
