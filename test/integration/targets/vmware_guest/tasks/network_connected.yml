# Test code for the vmware_guest module.
# Copyright: (c) 2018, Maximilian Prahl-Kamps <maximilian.prahl-kamps@fkie.fraunhofer.de>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

- name: disconnect network
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ dc1 }}"
    state: poweredoff
    folder: "{{ f0 }}"
    name: "network_connected"
    networks:
      - name: 'VM Network'
        connected: false
  register: disconnect_network
  ignore_errors: yes

- debug: var=disconnect_network

- name: assert that changes were made and no errors occured
  assert:
    that:
        - "not disconnect_network.failed"

- name: disconnect network again
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ dc1 }}"
    state: poweredoff
    folder: "{{ f0 }}"
    name: "network_connected"
    networks:
      - name: 'VM Network'
        connected: false
  register: disconnect_network
  ignore_errors: yes

- debug: var=disconnect_network

- name: assert that no changes were made and no errors occured
  assert:
    that:
        - "not disconnect_network.changed"
        - "not disconnect_network.failed"

- name: connect network
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ dc1 }}"
    state: poweredoff
    folder: "{{ f0 }}"
    name: "network_connected"
    networks:
      - name: 'VM Network'
        connected: true
  register: connect_network
  ignore_errors: yes

- debug: var=connect_network

- name: assert that no errors occured
  assert:
    that:
        - "connect_network.changed"
        - "not connect_network.failed"

- name: connect network again
  vmware_guest:
    hostname: "{{ vcenter_hostname }}"
    username: "{{ vcenter_username }}"
    password: "{{ vcenter_password }}"
    validate_certs: False
    datacenter: "{{ dc1 }}"
    state: poweredoff
    folder: "{{ f0 }}"
    name: "network_connected"
    networks:
      - name: 'VM Network'
        connected: true
  register: connect_network
  ignore_errors: yes

- debug: var=connect_network

- name: assert that no errors occured
  assert:
    that:
        - "not connect_network.changed"
        - "not connect_network.failed"
