# Test code for the vmware_content_library CRUD Operations.
# Copyright: (c) 2019, Pavan Bidkar <pbidkar@vmware.com>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

- when: vcsim is not defined
  block:
    - &content_lib_create
      name: Create Content Library
      vmware_content_library_manager:
        hostname: '{{ vcenter_hostname }}'
        username: '{{ vcenter_username }}'
        password: '{{ vcenter_password }}'
        validate_certs: False
        library_name: Sample_Library
        library_description: Sample Description
        state: present
      register: content_lib_create

    - name: Check content library is created
      assert:
        that:
          - content_lib_create.changed

    - <<: *content_lib_create
      name: Create content library again

    - name: Check if no changes are made
      assert:
        that:
          - not content_lib_create.changed

    # Testcase Update Content Library
    - &update_content_lib
      name: Update a content library
      vmware_content_library_manager:
        hostname: '{{ vcenter_hostname }}'
        username: '{{ vcenter_username }}'
        password: '{{ vcenter_password }}'
        validate_certs: no
        library_name: Sample_Library
        library_description: Update Sample Description
        state: present
      register: content_lib_update

    - name: Check content library is updated
      assert:
        that:
          - content_lib_update.changed

    # Testcase Delete the content library
    - &content_lib_delete
      name: Delete content library
      vmware_content_library_manager:
        hostname: '{{ vcenter_hostname }}'
        username: '{{ vcenter_username }}'
        password: '{{ vcenter_password }}'
        validate_certs: no
        library_name: Sample_Library
        state: absent
      register: content_lib_delete

    - name: Check content library is Deleted
      assert:
        that:
          - content_lib_delete.changed
          
    - <<: *content_lib_delete
      name: Delete content library again

    - name: Check if no changes are made
      assert:
        that:
          - not content_lib_delete.changed