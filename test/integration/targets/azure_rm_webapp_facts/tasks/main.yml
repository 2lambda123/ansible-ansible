- name: Prepare facts
  set_fact:
    win_plan_name: "{{ (resource_prefix | replace('-','x'))[-8:] }}winplan"
    win_app_name: "{{ (resource_prefix | replace('-','x'))[-8:] }}winapp"

- name: Create a win web app with java run time specific
  azure_rm_webapp:
    resource_group: "{{ resource_group }}"
    name: "{{ win_app_name }}"
    plan: "{{ win_plan_name }}"
    frameworks:
      - name: "java"
        version: "1.8"
        settings:
          java_container: "Tomcat"
          java_container_version: "8.0"
    app_settings:
      testkey: "testvalue"

- name: get web app with name
  azure_rm_webapp_facts:
    resource_group: "{{ resource_group }}"
    name: "{{ win_app_name }}"
    info_level:
      - level: "app_settings"
      - level: "configuration"
  register: output

- assert:
    that:
      - output.ansible_facts.azure_webapps | length == 1
      - output.ansible_facts.azure_webapps[0].app_settings.length == 1
      - output.ansible_facts.azure_webapps[0].frameworks.length == 2 # net_framework is default

- name: get web app with resource group and tag
  azure_rm_webapp_facts:
    resource_group: "{{ resource_group }}"
    tags:
      - testkey
  register: output

- assert:
    that:
      - output.ansible_facts.azure_webapps | length == 1