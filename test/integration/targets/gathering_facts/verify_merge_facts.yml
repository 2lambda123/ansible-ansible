- name: rune one and two, verify merge is as expected
  hosts: localhost
  vars:
    ansible_facts_modules:
        - facts_one
        - facts_two
  tasks:
    - name: try to update ref file
      copy: content={{ansible_facts|dictsort(true)|to_json}} dest=./one_two.json
      register: update

    - name: fail if ref file is updated
      assert:
        msg: '{{update.diff}}'
        that:
            - not update.diff

    - name: clear existing facts for next play
      meta: clear_facts


- name: rune two and one, verify merge is as expected
  hosts: localhost
  vars:
    ansible_facts_modules:
        - facts_two
        - facts_one
  tasks:
    - name: try to update ref file
      copy: content={{ansible_facts|dictsort(true)|to_json}} dest=./two_one.json
      register: update

    - name: fail if ref file is updated
      assert:
        msg: '{{update.diff}}'
        that:
            - not update.diff
