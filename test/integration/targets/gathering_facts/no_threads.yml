- hosts: localhost
  tasks:
  - block:

    - set_fact:
        normal_way: "{{ ansible_facts['mounts'] | map(attribute='mount') }}"

    - name: actual gather test
      gather_facts:
        gather_subset: hardware
      register: no_multi
      environment:
        _ANSIBLE_FACTS_DUMMY_POOL=1

    - set_fact:
        single_way: "{{ no_multi['ansible_facts']['ansible_mounts'] | map(attribute='mount') }}"

    - assert:
        that:
          - normal_way == single_way
    when:
      - ansible_facts['os_family'] not in ['FreeBSD', 'Darwin']
