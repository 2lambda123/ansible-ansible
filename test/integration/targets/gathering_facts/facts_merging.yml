- name: gather one and two facts
  hosts: localhost
  gather_facts: true
  vars_files:
    - vars/one_two.json
  vars:
   ansible_facts_modules:
     - facts_one
     - facts_two
  tasks:
  - block:
    - name: check expected merge strings
      assert:
        that:
            - onetwo[item] == ansible_facts[item]
      when: onetwo[item] is string

    - name: check expected merge sequences
      assert:
        that:
            - onetwo[item]|sort == ansible_facts[item]|sort
      when: onetwo[item] is not string and onetwo[item] is not mapping

    - name: check expected merge dicts
      assert:
        that:
            - onetwo[item]|dictsort == ansible_facts[item]|dictsort
      when: onetwo[item] is mapping
    loop: '{{onetwo.keys()|list}}'
    loop_control:
      label: "{{item}}: {{onewto[item]}} <=> {{ansible_facts[item]}}"


- name: gather two and one facts
  hosts: localhost
  gather_facts: true
  vars_files:
    - vars/two_one.json
  vars:
   ansible_facts_modules:
     - facts_two
     - facts_one
  tasks:
  - block:
    - name: check expected merge strings
      assert:
        that:
            - twoone[item] == ansible_facts[item]
      when: twoone[item] is string

    - name: check expected merge sequences
      assert:
        that:
            - twoone[item]|sort == ansible_facts[item]|sort
      when: twoone[item] is not string and twoone[item] is not mapping

    - name: check expected merge dicts
      assert:
        that:
            - twoone[item]|dictsort == ansible_facts[item]|dictsort
      when: twoone[item] is mapping

    loop: '{{twoone.keys()|list}}'
    loop_control:
      label: "{{item}}: {{twoone[item]}} <=> {{ansible_facts[item]}}"
