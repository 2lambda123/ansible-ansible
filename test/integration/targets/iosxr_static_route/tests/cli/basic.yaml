---
- name: setup - remove config used in test
  iosxr_static_route:
    aggregate:
      - { address: 192.168.3.0/24, next_hop: 10.0.2.2 }
      - { address: 192.168.4.0/24, next_hop: 10.0.2.2 }
      - { address: 192.168.5.0/24, next_hop: 10.0.2.2 }
    state: absent

- name: configure static route
  iosxr_static_route: &single_route
    address: 192.168.3.0/24
    next_hop: 10.0.2.2
    admin_distance: 2
  register: result

- assert:
    that:
      - "result.changed == true"
      - "'192.168.3.0/24 10.0.2.2 2' in result.commands"

- name: configure static route(Idempotence)
  iosxr_static_route: *single_route
  register: result

- assert:
    that:
      - "result.changed == false"

- name: delete static route
  iosxr_static_route: &delete_single
    address: 192.168.3.0/24
    next_hop: 10.0.2.2
    admin_distance: 2
    state: absent
  regiser: result

- assert:
    that:
      - "result.changed == true"
      - "'no 192.168.3.0/24 10.0.2.2' in result.commands"

- name: delete static route(Idempotence)
  iosxr_static_route: *delete_single
  register: result

- assert:
    that:
      - "result.changed == false"

- name: configure static routes using aggregate
  iosxr_static_route: &configure_aggregate
    aggregate:
      - { address: 192.168.4.0/24, next_hop: 10.0.2.2 }
      - { address: 192.168.5.0/24, next_hop: 10.0.2.2 }
  register: result

- assert:
    that:
      - "result.changed == true"
      - "'192.168.4.0/24 10.0.2.2' in result.commands"
      - "'192.168.5.0/24 10.0.2.2' in result.commands"

- name: configure static routes using aggregate(Idemporence)
  iosxr_static_route: *configure_aggregate
  register: result

- assert:
    that:
      - "result.changed == false"

- name: delete static routes using aggregate
  iosxr_static_route: &delete_aggregate
    aggregate:
      - { address: 192.168.4.0/24, next_hop: 10.0.2.2 }
      - { address: 192.168.5.0/24, next_hop: 10.0.2.2 }
    state: absent
  register: result

- assert:
    that:
      - "result.changed == true"
      - "'no 192.168.4.0/24 10.0.2.2' in result.commands"
      - "'no 192.168.5.0/24 10.0.2.2' in result.commands"

- name: delete static routes using aggregate(Idempotence)
  iosxr_static_route: *delete_aggregate
  register: result

- assert:
    that:
      - "result.changed == false"
