---
#
# Test cases:
#   Prerequisites: 1 node cluster with tetsnode1 running, testpkg1 running
# 
# Test cases
# - DONE 000 - Start all packages
# - DONE 001 - Stop all nodes
# - DONE 002 - Start all nodes
- name: 010 Start all the nodes (Pre-requisite for 020)
  serviceguard_node:
    name: "{{ ansible_hostname }}"
    state: started

- serviceguard_facts:
  register: facts

- assert:
    that:
      - facts.nodes[ansible_hostname].state == 'running'

- name: 020 Stop all the pacakges before stopping all the nodes
  serviceguard_pkg:
    name: "*"
    node: "{{ ansible_hostname }}"
    state: stopped
  register: state

- name: 021 Stop all the nodes
  serviceguard_node:
    name: "{{ ansible_hostname }}"
    state: stopped 
  register: state

- serviceguard_facts:
  register: facts
- assert:
    that:
      - state.nodes[ansible_hostname].status == 'unknown'
      - state.changed == True

- name: 030 Start all the nodes
  serviceguard_node:
    name: "{{ ansible_hostname }}"
    state: started
  register: state

- serviceguard_facts:
  register: facts
- assert:
    that:
      - facts.nodes[ansible_hostname].state == 'running'
      - state.changed == True