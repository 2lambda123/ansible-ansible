---
- name: Generate privatekey1 - standard
  connection: local
  openssh_keypair:
    path: '{{ output_dir }}/privatekey1'

- name: Generate privatekey2 - size 2048
  openssh_keypair:
    path: '{{ output_dir }}/privatekey2'
    size: 2048

- name: Generate privatekey3 - type dsa
  openssh_keypair:
    path: '{{ output_dir }}/privatekey3'
    type: dsa

- name: Generate privatekey4 - standard
  openssh_keypair:
    path: '{{ output_dir }}/privatekey4'

- name: Delete privatekey4 - standard
  openssh_keypair:
    state: absent
    path: '{{ output_dir }}/privatekey4'

- name: Generate privatekey5 - standard
  openssh_keypair:
    path: '{{ output_dir }}/privatekey5'
  register: publickey_gen

- name: Create broken key
  copy:
    dest: "{{ item }}"
    content: ""
    mode: "0700"
  loop:
    - "{{ output_dir }}/privatekeybroken"
    - "{{ output_dir }}/privatekeybroken.pub"
- name: Regenerate broken key
  openssh_keypair:
    path: '{{ output_dir }}/privatekeybroken'
    type: rsa
  register: output_broken

- import_tasks: ../tests/validate.yml
