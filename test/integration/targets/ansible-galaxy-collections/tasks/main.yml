---
- name: create scratch dir used for testing
  file:
    path: '{{ galaxy_dir }}/scratch'
    state: directory

- name: run ansible-galaxy collection init tests
  import_tasks: init.yml

- name: run ansible-galaxy collection build tests
  import_tasks: build.yml

- name: run ansible-galaxy collection publish tests for {{ test_name }}
  include_tasks: publish.yml
  vars:
    test_name: '{{ item.name }}'
    test_server: '{{ item.server }}'
  with_items:
  - name: Galaxy
    server: '{{ galaxy_server }}'
  - name: Automation Hub
    server: '{{ ah_server }}'

- name: run ansible-galaxy collection install tests for {{ test_name }}
  include_tasks: install.yml
  vars:
    test_name: '{{ item.name }}'
    test_server: '{{ item.server }}'
  with_items:
  - name: Galaxy
    server: '{{ galaxy_server }}'
  - name: Automation Hub
    server: '{{ ah_server }}'
