---
# https://www.rabbitmq.com/ssl.html#automated-certificate-generation-transcript
- name: ensure requirements are present
  apt:
    name: "{{ item }}"
    update_cache: yes
  loop:
    - openssl
    - git
    - make

- name: obtain tls-gen
  git:
    repo: https://github.com/michaelklishin/tls-gen.git
    dest: /tls

- name: generate certificates with a basic profile
  command: make PASSWORD=bunnies
  args:
    chdir: /tls/basic/
    creates: /tls/basic/result/client_certificate.pem

- name: verify certificates
  command: make verify
  args:
    chdir: /tls/basic/
