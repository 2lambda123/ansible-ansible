- name: create src file
  copy:
    dest: '{{ files_dir }}/uri-resolved.txt'
    content: 'ptux'

- name: Fetch file from
  ansible.builtin.uri:
    url: http://hostname/uri-resolved.txt
    return_content: yes
    resolve:
      hostname: 127.0.0.1:{{ http_port }}
  register: result_uri_resolved_host

- name: Assert that the content was fetched from the resolved host
  assert:
    that:
      - result_uri_resolved_host.content == 'ptux'
      - result_uri_resolved_host.url =='http://hostname/uri-resolved.txt'
