- name: Test import_role
  hosts: testhost

  vars:
    role_name: role1
    role_vars:
      where_am_i_defined: in the playbook
    entire_task:
      import_role:
        # name: role1

  tasks:
    - name: Test basic role include
      import_role:
        name: role1

    - name: Test role include with a loop
      import_role:
        name: "{{ item }}"
      ignore_errors: yes
      with_items:
        - role1
        - role2

    - name: Test including a task file
      import_role:
        name: role1
        tasks_from: tasks.yml

    - name: Test including vars file and tasks file from a role
      import_role:
        name: role3
        tasks_from: vartest.yml
        vars_from: role3vars.yml
        private: no

    - name: Use variable for role name
      import_role:
        name: "{{ role_name }}"

    - name: Pass variable to role
      import_role:
        name: role1
        tasks_from: vartest.yml
      vars:
        where_am_i_defined: in the task

    # FIXME Currently failing
    # Not sure if this is suppsode to work
    # - name: Pass all variables in a variable to role
    #   import_role:
    #     name: role1
    #     tasks_from: vartest.yml
    #   vars: "{{ role_vars }}"

    - name: Pass templated variable to a role
      import_role:
        name: role1
        tasks_from: vartest.yml
      vars:
        where_am_i_defined: in the playbook

    # This fails gloriously
    # - name: Include an entire task
    #   action:
    #     module: "{{ entire_task }}"

