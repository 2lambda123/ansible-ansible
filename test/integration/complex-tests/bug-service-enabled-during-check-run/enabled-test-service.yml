---
- hosts: all
  become: yes
  tasks:
    - block:
        - name: enable service first time
          service: name=ansible_test enabled=yes
          register: enabled_res_1

        - name: assert that state changed
          assert:
            that:
            - "enabled_res_1.changed == true"

        - name: enable service second time
          service: name=ansible_test enabled=yes
          register: enabled_res_2

        - name: assert that state changed again (in the check mode it should)
          assert:
            that:
            - "enabled_res_2.changed == true"
        # On some Docker images there is error 'Could not find the requested service "ansible_test"'
        # Skip those images
      when: not ((ansible_distribution == 'CentOS' and ansible_distribution_version|version_compare('7', '>=')) or (ansible_distribution == 'Fedora') or ((ansible_distribution == 'Ubuntu' and ansible_distribution_version|version_compare('15.04', '>='))))
