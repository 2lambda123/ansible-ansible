- hosts: testhost
  vars_files:
    - vars/test_var_encrypted.yml

  gather_facts: False

  tasks:
    - assert:
        that:
          - 'secret_var == "secret"'

    - name: load the encrypted vars file as a fact
      set_fact:
        secret_contents: "{{ lookup('file', 'vars/test_var_encrypted.yml') }}"

    - name: verify file lookup supports vault
      assert:
        that:
          - 'secret_contents.splitlines()[0] == "---"'
