---
- set_fact:
    proj:
      - AnsibleDev1
      - AnsibleDev2

# - name: Create new projects
#   digital_ocean_project:
#     state: present
#     name: '{{item}}'
#     description: Project created for integration test
#     purpose: Just trying out DigitalOcean
#     environment: development
#     oauth_token: "{{ digitalocean_oauth_token }}"
#   loop: '{{proj}}'

- name: Query all projects
  digital_ocean_project_facts:
    oauth_token: "{{ digitalocean_oauth_token }}"
  register: query_all

- assert:
    that:
      - query_all.data | length >= 2

- name: Query one project by name
  digital_ocean_project_facts:
    oauth_token: "{{ digitalocean_oauth_token }}"
    name: Development
  register: query_dev

- assert:
    that:
      - query_dev.changed == False
      - query_dev.data.project.name == "Development"

- name: Query default project
  digital_ocean_project_facts:
    oauth_token: "{{ digitalocean_oauth_token }}"
    default: true
  register: query_default

- name: Query default project resources
  digital_ocean_project_facts:
    oauth_token: "{{ digitalocean_oauth_token }}"
    default: true
    resources: true
  register: query_default_resources

- name: Query Production project resources
  digital_ocean_project_facts:
    oauth_token: "{{ digitalocean_oauth_token }}"
    name: Production
    resources: true
  register: query_dev_resources
